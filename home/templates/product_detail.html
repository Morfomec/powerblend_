{% extends 'home_base.html' %}
{% block content %}
<h1>Welcome, {{request.user.username }}!</h1>
{% endblock content %}
{% block extra_css %}
<style>
        :root {
            --primary-teal: rgb(0 57 66 / 1);
            --light-teal: #4a9b96;
            --orange: #ff6b35;
            --dark-gray: #333;
            --light-gray: #f8f9fa;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            color: var(--dark-gray);
            margin: 0;
            padding: 0;
            background-color: #fff;
        }

        /* Header */
        .top-bar {
            background-color: var(--primary-teal);
            color: white;
            padding: 8px 0;
            font-size: 12px;
        }

        .navbar-custom {
            background-color: white;
            border-bottom: 1px solid #e9ecef;
            padding: 1rem 0;
        }


        
        .logo {
            font-weight: bold;
            color: var(--primary-solid);
            font-size: 1.5rem;
            text-decoration: none;
            display: flex;
            align-items: center;
        }

        .logo::before {
            content: "M";
            background: var(--primary-solid);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
            font-weight: bold;
    }

        .search-bar {
            max-width: 400px;
            margin: 0 auto;
        }

        .search-input {
            border: 2px solid var(--primary-teal);
            border-radius: 25px;
            padding: 10px 20px;
            width: 100%;
        }

        /* Breadcrumb */
        .breadcrumb-section {
            background-color: var(--light-gray);
            padding: 10px 0;
        }

        .breadcrumb {
            background: none;
            padding: 0;
            margin: 0;
        }

        .breadcrumb-item a {
            color: var(--primary-teal);
            text-decoration: none;
            font-size: 14px;
        }

        /* Product Section */
        .product-container {
            background-color: white;
            padding: 30px;
        }

        .product-image {
            max-width: 100%;
            height: auto;
        }

        .product-thumbnails {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .thumbnail {
            width: 60px;
            height: 60px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            object-fit: cover;
        }

        .thumbnail.active {
            border-color: var(--primary-teal);
            border-width: 2px;
        }

        .rating-stars {
            color: var(--primary-teal);
            font-size: 16px;
            margin-bottom: 10px;
        }

        .rating-count {
            color: var(--primary-teal);
            text-decoration: underline;
            font-size: 14px;
            margin-left: 10px;
        }

        .product-title {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary-teal);
            margin-bottom: 10px;
        }

        .product-subtitle {
            color: #666;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .price-section {
            margin-bottom: 20px;
        }

        .current-price {
            font-size: 32px;
            font-weight: bold;
            color: var(--dark-gray);
        }

        .original-price {
            background-color: #dc3545;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 14px;
            text-decoration: line-through;
            margin-left: 15px;
        }

        .savings {
            background-color: #28a745;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 14px;
            margin-left: 10px;
        }

        .price-per-kg {
            color: #666;
            font-size: 14px;
            margin-top: 5px;
        }

        .section-label {
            font-weight: 600;
            color: var(--dark-gray);
            margin-bottom: 10px;
            font-size: 16px;
        }

        .flavor-selector, .amount-selector {
            margin-bottom: 20px;
        }

        .selector-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .selector-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background-color: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .selector-btn.active {
            background-color: var(--primary-teal);
            color: white;
            border-color: var(--primary-teal);
        }

        .dropdown-select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .promo-banner {
            background-color: #d4f4dd;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
            color: #155724;
        }

        .quantity-section {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .qty-controls {
            display: flex;
            align-items: center;
        }

        .qty-btn {
            background-color: white;
            border: 1px solid #ddd;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 16px;
        }

        .qty-input {
            border: 1px solid #ddd;
            padding: 8px 12px;
            text-align: center;
            width: 60px;
            border-left: none;
            border-right: none;
        }

        .add-to-basket {
            background-color: var(--primary-teal);
            color: white;
            border: none;
            padding: 15px 30px;
            width: 100%;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            cursor: pointer;
        }

        .add-to-basket:hover {
            background-color: rgba(0, 57, 66, 0.8);
        }

        .wishlist-btn {
            border: 1px solid #016663;
            background-color: white;
            padding: 15px;
            border-radius: 6px;
            cursor: pointer;
            color: var(--primary-teal);
        }

        .stock-info {
            background-color: var(--light-gray);
            padding: 15px;
            border-radius: 6px;
            font-size: 14px;
            color: #28a745;
        }

        /* Product Details Sections */
        .product-details {
            background-color: white;
            margin-top: 30px;
        }

        .details-tabs {
            border-bottom: 1px solid #ddd;
            display: flex;
            overflow-x: auto;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 15px 20px;
            cursor: pointer;
            font-size: 14px;
            color: #666;
            white-space: nowrap;
        }

        .tab-btn.active {
            color: var(--primary-teal);
            border-bottom: 2px solid var(--primary-teal);
        }

        .tab-content {
            padding: 20px;
        }

        .nutritional-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .nutrition-table {
            background-color: var(--light-gray);
            padding: 15px;
            border-radius: 6px;
        }

        .nutrition-table h5 {
            color: var(--primary-teal);
            margin-bottom: 15px;
            font-size: 16px;
        }

        .nutrition-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        /* Promotion Section */
        .promo-section {
            background: linear-gradient(135deg, #fff2e6 0%, #ffe6cc 100%);
            padding: 40px;
            margin: 30px 0;
            border-radius: 10px;
            text-align: center;
        }

        .promo-title {
            font-size: 32px;
            font-weight: bold;
            color: var(--primary-teal);
            margin-bottom: 10px;
        }

        .promo-subtitle {
            font-size: 18px;
            color: var(--orange);
            margin-bottom: 20px;
        }

        /* Related Products */
        .related-products {
            margin: 40px 0;
        }

        .section-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-teal);
            margin-bottom: 20px;
            text-align: center;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .product-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: white;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .product-card-image {
            width: 100%;
            height: 150px;
            object-fit: contain;
            margin-bottom: 15px;
        }

        .product-card-title {
            font-size: 16px;
            font-weight: bold;
            color: var(--primary-teal);
            margin-bottom: 10px;
        }

        .product-card-price {
            font-size: 18px;
            font-weight: bold;
            color: var(--dark-gray);
            margin-bottom: 15px;
        }

        .card-btn {
            background-color: var(--primary-teal);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            width: 100%;
            cursor: pointer;
        }

        /* Reviews Section */
        .reviews-section {
            background-color: var(--light-gray);
            padding: 30px;
            margin: 30px 0;
            border-radius: 8px;
        }

        .review-summary {
            text-align: center;
            margin-bottom: 30px;
        }

        .review-score {
            font-size: 48px;
            font-weight: bold;
            color: var(--primary-teal);
        }

        .review-item {
            background-color: white;
            padding: 20px;
            border-radius: 6px;
            margin-bottom: 15px;
            border-left: 4px solid var(--orange);
        }

        .reviewer-name {
            font-weight: bold;
            color: var(--primary-teal);
            margin-bottom: 5px;
        }

        .review-date {
            color: #666;
            font-size: 12px;
            margin-bottom: 10px;
        }

        .review-text {
            color: var(--dark-gray);
            line-height: 1.5;
        }

        /* Personalized Section */
        .personalized-section {
            background: linear-gradient(135deg, var(--primary-teal) 0%, rgba(0, 57, 66, 0.8) 100%);
            color: white;
            padding: 40px;
            margin: 30px 0;
            border-radius: 10px;
        }

        .personalized-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .personalized-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .personalized-item {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 6px;
            text-align: center;
        }
        .modal {
        display: none;
        position: fixed;
        z-index: 9999;
        padding-top: 60px;
        left: 0; top: 0; width: 100%; height: 100%;
        background-color: rgba(0,0,0,0.8);
        }
        .modal-content {
        margin: auto;
        display: block;
        max-width: 80%;
        max-height: 80%;
        }
        .close {
        position: absolute;
        top: 15px; right: 35px;
        color: white; font-size: 40px; cursor: pointer;
        }

        /* Change modal header, buttons, and highlights to primary color */
        #basketModal .modal-content {
            border-radius: 1rem;
            background-color: white; /* #1a4d4d with slight transparency */
            color: black;
        }

        /* Adjust button styles */
        #basketModal .btn-dark {
            background-color: #1a4d4d;
            border-color: #1a4d4d;
        }
        #basketModal .btn-dark:hover {
            background-color: #163d3d;
            border-color: #163d3d;
        }
        #basketModal .btn-outline-dark {
            color: #1a4d4d;
            border-color: #1a4d4d;
        }
        #basketModal .btn-outline-dark:hover {
            background-color: #1a4d4d;
            color: #fff;
        }

        /* Make the modal backdrop more transparent */
        .modal-backdrop.show {
            opacity: 0.1; /* default is 0.5 */
        }

        /* Authentication Modal */
        .auth-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }

        .auth-modal-overlay.active {
            display: flex;
        }

        .auth-modal-content {
            background: white;
            border-radius: 16px;
            padding: 2.5rem;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            text-align: center;
            animation: modalSlideUp 0.3s ease-out;
        }

        @keyframes modalSlideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .auth-modal-icon {
            width: 70px;
            height: 70px;
            margin: 0 auto 1.5rem;
            background: linear-gradient(135deg, var(--primary-teal), rgba(0, 57, 66, 0.8));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .auth-modal-icon i {
            font-size: 2rem;
            color: white;
        }

        .auth-modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-teal);
            margin-bottom: 0.75rem;
        }

        .auth-modal-message {
            font-size: 1rem;
            color: #666;
            margin-bottom: 2rem;
            line-height: 1.5;
        }

        .auth-modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .auth-modal-btn {
            flex: 1;
            padding: 0.875rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            text-decoration: none;
            display: inline-block;
        }

        .auth-modal-btn-primary {
            background: var(--primary-teal);
            color: white;
        }

        .auth-modal-btn-primary:hover {
            background: rgba(0, 57, 66, 0.9);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 57, 66, 0.3);
        }

        .auth-modal-btn-secondary {
            background: white;
            color: var(--primary-teal);
            border: 2px solid var(--primary-teal);
        }

        .auth-modal-btn-secondary:hover {
            background: var(--primary-teal);
            color: white;
        }


        .selector-btn {
    padding: 8px 16px;
    border: 1px solid #ddd;
    background-color: white;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    text-decoration: none;
    color: inherit;
    display: inline-block;
    transition: all 0.3s ease;
}

.selector-btn.active {
    background-color: var(--primary-teal);
    color: white;
    border-color: var(--primary-teal);
    cursor: default;
}

.selector-btn.disabled {
    background-color: #f5f5f5;
    color: #999;
    cursor: not-allowed;
    border-color: #ddd;
    opacity: 0.6;
}

.selector-btn:not(.active):not(.disabled):hover {
    border-color: var(--primary-teal);
    background-color: rgba(0, 57, 66, 0.1);
}

        @media (max-width: 576px) {
            .auth-modal-buttons {
                flex-direction: column;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .selector-buttons {
                flex-direction: column;
            }
            
            .quantity-section {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .product-grid {
                grid-template-columns: 1fr;
            }
            
            .current-price {
                font-size: 24px;
            }
            
            .product-title {
                font-size: 20px;
            }
        }
        
        @media (min-width: 1536px) {
            .container {
                max-width: 2000px;
            }
        }
    </style>

    <style>
    /* Modern Breadcrumb Section */
    .modern-breadcrumb-section {
        background: rgba(248, 249, 250, 0.4);
        padding: 1.5rem 0;
        margin-bottom: 2rem;
    }

    .modern-breadcrumb {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        flex-wrap: wrap;
        background:  rgba(248, 249, 250, 0.4);
        padding: 0;
        border-radius: 50px;
        /* box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06); */
        margin: 0 auto;
        list-style: none;
        gap: 0.5rem;
        max-width: fit-content;
    }
    
    .modern-breadcrumb-section .container {
        text-align: center;
    }

    .modern-breadcrumb .breadcrumb-item {
        display: flex;
        align-items: center;
        font-size: 0.9rem;
        font-weight: 500;
        position: relative;
    }

    .modern-breadcrumb .breadcrumb-item + .breadcrumb-item::before {
        content: "";
        display: inline-block;
        width: 6px;
        height: 6px;
        background: var(--primary-teal);
        border-radius: 50%;
        margin: 0 1rem;
        opacity: 0.5;
    }

    .modern-breadcrumb .breadcrumb-item a {
        display: flex;
        align-items: center;
        gap: 0.4rem;
        color: var(--primary-teal);
        text-decoration: none;
        padding: 0.4rem 0.8rem;
        border-radius: 20px;
        transition: all 0.3s ease;
        position: relative;
    }

    .modern-breadcrumb .breadcrumb-item a:hover {
        background: var(--primary-teal);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 57, 66, 0.2);
    }

    .modern-breadcrumb .breadcrumb-item a i {
        font-size: 0.85rem;
    }

    .modern-breadcrumb .breadcrumb-item.active {
        color: #6c757d;
        padding: 0.4rem 0.8rem;
        background: rgba(248, 249, 250, 0.6);
        border-radius: 20px;
    }

    .modern-breadcrumb .breadcrumb-item.active span {
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .modern-breadcrumb-section {
            padding: 1rem 0;
            margin-bottom: 1.5rem;
        }

        .modern-breadcrumb {
            padding: 0.75rem 1rem;
            font-size: 0.85rem;
        }

        .modern-breadcrumb .breadcrumb-item a,
        .modern-breadcrumb .breadcrumb-item.active {
            padding: 0.4rem 0.75rem;
        }

        .modern-breadcrumb .breadcrumb-item + .breadcrumb-item::before {
            margin: 0 0.5rem;
            width: 5px;
            height: 5px;
        }

        .modern-breadcrumb .breadcrumb-item.active span {
            max-width: 150px;
        }
    }

    @media (max-width: 576px) {
        .modern-breadcrumb {
            border-radius: 25px;
            padding: 0.5rem 0.75rem;
        }

        .modern-breadcrumb .breadcrumb-item a span,
        .modern-breadcrumb .breadcrumb-item.active span {
            display: none;
        }

        .modern-breadcrumb .breadcrumb-item a i {
            font-size: 1rem;
        }

        .modern-breadcrumb .breadcrumb-item a,
        .modern-breadcrumb .breadcrumb-item.active {
            padding: 0.5rem;
        }
    }
</style>

{% endblock extra_css %}

{% block body %}

    <!-- Breadcrumb
    <div class="breadcrumb-section">
        <div class="container">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'list_products' %}">Shop</a></li>
                    <li class="breadcrumb-item active" aria-current="page">{{ product.name }}</li>
                </ol>
            </nav>
        </div>
    </div> -->



    <!-- Modern Breadcrumb Section -->
    <div class="modern-breadcrumb-section">
        <div class="container">
            <nav aria-label="breadcrumb">
                <ol class="modern-breadcrumb">
                    <li class="breadcrumb-item">
                        <a href="{% url 'home' %}">
                            <i class="fas fa-home"></i>
                            <span>Home</span>
                        </a>
                    </li>
                    <li class="breadcrumb-item">
                        <a href="{% url 'list_products' %}">
                            <i class="fas fa-shopping-bag"></i>
                            <span>Shop</span>
                        </a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">
                        <span>{{ product.name }}</span>
                    </li>
                </ol>
            </nav>
        </div>
    </div>

    <!-- Main Product Section -->
    <div class="container">
        <div class="product-container">
            <div class="row">
                <!-- Product Images -->
                <div class="col-lg-6 col-md-12">
                    <div class="text-end mb-3">
                        
                    </div>
                    
                    <div class="product-image-container">
                        {% if product.images.all %}
                            <img id="main-product-image" src="{{ product.images.first.image.url }}" alt="{{ product.name }}" class="product-image" style="cursor: zoom-in;">
                        {% else %}
                            <img id="main-product-image" src="https://via.placeholder.com/400x400?text=No+Image" alt="No image available" class="product-image">
                        {% endif %}
                    </div>

                <!-- #for thumbnail -->
                    <div class="product-thumbnails">
                        {% for img in product.images.all %}
                            <img src="{{ img.image.url }}" class="thumbnail {% if forloop.first %}active{% endif %}" alt="{{ product.name }} image {{ forloop.counter}}">
                        {% endfor %}
                    </div>

                    <div id="imageModal" class="modal" style="display:none;">
                        <span class="close">&times;</span>
                        <img class="modal-content" id="enlarged-image">
                    </div>
                </div>

                <!-- Product Details -->
                <div class="col-lg-6 col-md-12">
                    <div class="rating-stars">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star-half-alt"></i>
                        <span class="rating-count">4,267</span>
                    </div>
                    

                    <h1 class="product-title">{{ product.name }}</h1>
                    <p class="product-subtitle">{{ product.description }}</p>
                    
                    <!-- price -->

{% if selected_variant_info %}
    <div class="price-section">
        <span class="current-price">₹{{ selected_variant_info.price }}</span>

        {% if selected_variant_info.has_discount and selected_variant_info.original_price %}
            <span class="original-price">Was ₹{{ selected_variant_info.original_price }}</span>
        {% endif %}

        {% if selected_variant_info.save_amount and selected_variant_info.save_amount > 0 %}
            <span class="savings">Save ₹{{ selected_variant_info.save_amount }}</span>
        {% endif %}
    </div>
{% endif %}

                    

                    {% if best_offer %}
                        <div class="discount-badge">
                            {{ best_offer.name|upper }} - {{ best_offer.discount_percent }}% OFF
                        </div>
                    {% else %}
                        <div class="discount-badge">Exclusive Offers awaits</div>
                    {% endif %}
                    
                    <!-- Flavor Selector -->
                    <div class="flavor-selector">
                        <div class="section-label">Flavour:</div>
                        <div class="selector-buttons">
                            {% for flavor_name, data in available_flavors.items %}
                                {% if selected_variant_info.flavor.flavor == flavor_name %}
                                    <button class="selector-btn active" disabled>{{ flavor_name }}</button>
                                {% else %}
                                    <a href="?weight={{ selected_variant_info.weight.weight }}&flavor={{ flavor_name|urlencode }}"
                                    class="selector-btn {% if not data.available %}disabled{% endif %}"
                                    {% if not data.available %}onclick="return false;"{% endif %}>
                                        {{ flavor_name }}
                                    </a>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- Size Selector -->
                    <div class="amount-selector">
                        <div class="section-label">Size:</div>
                        <div class="selector-buttons">
                            {% for weight, data in available_weights.items %}
                                {% if selected_variant_info.weight == weight %}
                                    <button class="selector-btn active" disabled>
                                        {{ weight|upper }}
                                    </button>
                                {% else %}
                                    <a href="?weight={{ weight }}&flavor={{ selected_variant_info.flavor }}" 
                                    class="selector-btn {% if not data.available %}disabled{% endif %}"
                                    {% if not data.available %}onclick="return false;"{% endif %}>
                                        {{ weight|upper }}
                                    </a>
                                {% endif %}
                            {% empty %}
                                <p class="text-muted">No sizes available</p>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <div class="promo-banner">
                        <strong>PROTEIN SALE</strong> | GET EXTRA 15% OFF ON CREATINE | Use code: <strong>CREATINE15</strong>
                    </div>
                    
                    <!-- <div class="quantity-section">
                        <div class="section-label">Quantity:</div>
                        <div class="qty-controls">
                            <button type="button" class="qty-btn">−</button>
                            <input type="number" value="1" max="{{ product.stock }}" class="qty-input">
                            <button type="button" class="qty-btn">+</button>
                        </div>
                    </div> -->

                    <!-- Add to Basket Form -->
                    
                    <div class="row">
                        <div class="col-10">
                            {% if user.is_authenticated %}
                                {% if selected_variant.stock > 0 %}
                                    <form id="add-to-basket-form" method="POST" action="{% url 'basket_add' %}">
                                        {% csrf_token %}
                                        <input type="hidden" name="variant_id" value="{{ selected_variant.id }}">
                                        <input type="hidden" name="quantity" value="1">
                                        <button type="submit" class="add-to-basket">
                                            <i class="fas fa-shopping-basket me-2"></i>ADD TO BASKET
                                        </button>
                                    </form>
                                {% else %}
                                    <button type="button" class="add-to-basket" disabled style="background-color: #ccc; cursor: not-allowed;">
                                        <i class="fas fa-times me-2"></i>OUT OF STOCK
                                    </button>
                                {% endif %}
                            {% else %}
                                <button type="button" class="add-to-basket" onclick="openAuthModal()">
                                    <i class="fas fa-shopping-basket me-2"></i>ADD TO BASKET
                                </button>
                            {% endif %}
                        </div>
                        <div class="col-2">
                            {% if user.is_authenticated %}
                                <form method="post" action="{% url 'wishlist_add' selected_variant.id %}">
                                    {% csrf_token %}
                                    <button type="submit" class="wishlist-btn w-100">
                                        {% if selected_variant.id in wishlist_variant_ids %}
                                            <i class="fas fa-heart" style="color: #dc3545;"></i>
                                        {% else %}
                                            <i class="far fa-heart"></i>
                                        {% endif %}
                                    </button>
                                </form>
                            {% else %}
                                <button class="wishlist-btn w-100" onclick="openAuthModal()">
                                    <i class="far fa-heart"></i>
                                </button>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="stock-info">
                        <i class="fas fa-check me-2"></i>
                        {% if selected_variant.stock > 0 %}
                            {% if selected_variant.stock <= 5 %}
                                Only {{ selected_variant.stock }} left in stock | Order soon!
                            {% else %}
                                In stock | Usually dispatched within 24 hours
                            {% endif %}
                        {% else %}
                            <span style="color: #dc3545;">Out of stock</span>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Basket Modal -->
            <div class="modal fade" id="basketModal" tabindex="-1">
                <div class="modal-dialog modal-lg modal-dialog-centered">
                    <div class="modal-content p-4">
                        <button type="button" class="btn-close ms-auto" data-bs-dismiss="modal"></button>
                        <div class="row">
                            <div class="col-md-4 text-center">
                                <img id="basket-product-image" src="" alt="Product" class="img-fluid">
                            </div>
                            <div class="col-md-8">
                                <h5 id="basket-product-name"></h5>
                                <p><strong>Quantity:</strong> <span id="basket-quantity"></span></p>
                                <p><strong>Subtotal:</strong> ₹<span id="basket-subtotal"></span></p>
                                <p><span id="basket-count"></span> items in your basket</p>
                                <div class="mt-3">
                                    <a href="{% url 'detail_product' product.id %}" class="btn btn-outline-dark">Continue shopping</a>
                                    <a href="{% url 'basket_view' %}" class="btn btn-dark">View your basket</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Authentication Required Modal -->
            <div class="auth-modal-overlay" id="authModal">
                <div class="auth-modal-content">
                    <div class="auth-modal-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <h3 class="auth-modal-title">Sign in Required</h3>
                    <p class="auth-modal-message">Wish to continue? Please sign in to access this feature.</p>
                    <div class="auth-modal-buttons">
                        <button type="button" class="auth-modal-btn auth-modal-btn-secondary" onclick="closeAuthModal()">
                            <i class="fas fa-arrow-left me-2"></i>Go Back
                        </button>
                        <a href="{% url 'login' %}" class="auth-modal-btn auth-modal-btn-primary">
                            <i class="fas fa-sign-in-alt me-2"></i>Sign In
                        </a>
                    </div>
                </div>
            </div>
        </div>



















        
        <!-- Promotion Section -->
        <div class="promo-section">
            <div class="promo-title">OUR BEST SELLING</div>
            <div class="promo-subtitle">PROTEIN</div>
            <p>Discover our most popular protein supplements trusted by millions worldwide</p>
        </div>

        <!-- Product Details Tabs -->
        <div class="product-details">
            <div class="details-tabs">
                <button class="tab-btn active" data-tab="overview">Overview</button>
                <button class="tab-btn" data-tab="nutrition">Nutritional Information</button>
                <button class="tab-btn" data-tab="ingredients">Ingredients</button>
                <button class="tab-btn" data-tab="directions">Directions</button>
                <button class="tab-btn" data-tab="allergens">Allergens</button>
            </div>
            
            <div class="tab-content" id="overview">
                <h3>Product Overview</h3>
                <p>Our Complete Creatine Monohydrate is one of the most researched sports supplements available. Creatine monohydrate has been shown to increase physical performance in successive bursts of short-term, high intensity exercise.</p>
                
                <h4>Key Benefits:</h4>
                <ul>
                    <li>Increases physical performance in successive bursts of short-term, high intensity exercise</li>
                    <li>Helps increase power output during training</li>
                    <li>Supports muscle growth and strength gains</li>
                    <li>Enhances recovery between sets</li>
                </ul>
                
                <h4>When to Take:</h4>
                <p>Mix 1 scoop (5g) with 250ml of water or juice and consume 30-60 minutes before training. On non-training days, consume anytime throughout the day.</p>
            </div>
        </div>

        <!-- Nutritional Information -->
        <div class="nutritional-info">
            <div class="nutrition-table">
                <h5>Per Serving (5g)</h5>
                <div class="nutrition-row">
                    <span>Energy</span>
                    <span>0 kcal</span>
                </div>
                <div class="nutrition-row">
                    <span>Protein</span>
                    <span>0g</span>
                </div>
                <div class="nutrition-row">
                    <span>Carbohydrates</span>
                    <span>0g</span>
                </div>
                <div class="nutrition-row">
                    <span>Fat</span>
                    <span>0g</span>
                </div>
                <div class="nutrition-row">
                    <span><strong>Creatine Monohydrate</strong></span>
                    <span><strong>5g</strong></span>
                </div>
            </div>
            
            <div class="nutrition-table">
                <h5>Per 100g</h5>
                <div class="nutrition-row">
                    <span>Energy</span>
                    <span>0 kcal</span>
                </div>
                <div class="nutrition-row">
                    <span>Protein</span>
                    <span>0g</span>
                </div>
                <div class="nutrition-row">
                    <span>Carbohydrates</span>
                    <span>0g</span>
                </div>
                <div class="nutrition-row">
                    <span>Fat</span>
                    <span>0g</span>
                </div>
                <div class="nutrition-row">
                    <span><strong>Creatine Monohydrate</strong></span>
                    <span><strong>100g</strong></span>
                </div>
            </div>
        </div>

        <!-- Related Products -->
        <div class="related-products">
            <h2 class="section-title">Related Products</h2>
            <div class="product-grid">
                <div class="product-card">
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZmY2YjM1Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0iY2VudHJhbCI+SW1wYWN0IFdoZXk8L3RleHQ+PC9zdmc+" alt="Impact Whey Protein" class="product-card-image">
                    <h3 class="product-card-title">Impact Whey Protein</h3>
                    <div class="product-card-price">₹1,999</div>
                    <button class="card-btn">Quick Buy</button>
                </div>
                
                <div class="product-card">
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMDA5NDJmIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0iY2VudHJhbCI+QkNBQSAyOjE6MTwvdGV4dD48L3N2Zz4=" alt="BCAA 2:1:1" class="product-card-image">
                    <h3 class="product-card-title">BCAA 2:1:1</h3>
                    <div class="product-card-price">₹1,499</div>
                    <button class="card-btn">Quick Buy</button>
                </div>
                
                <div class="product-card">
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjNjY2Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0iY2VudHJhbCI+VGhlIFdoZXk8L3RleHQ+PC9zdmc+" alt="The Whey" class="product-card-image">
                    <h3 class="product-card-title">The Whey</h3>
                    <div class="product-card-price">₹3,999</div>
                    <button class="card-btn">Quick Buy</button>
                </div>
                
                <div class="product-card">
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZmZkNzAwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiMzMzMiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJjZW50cmFsIj5HbHV0YW1pbmU8L3RleHQ+PC9zdmc+" alt="L-Glutamine" class="product-card-image">
                    <h3 class="product-card-title">L-Glutamine</h3>
                    <div class="product-card-price">₹1,799</div>
                    <button class="card-btn">Quick Buy</button>
                </div>
            </div>
        </div>

        <!-- Personalized Section -->
        <div class="personalized-section">
            <h2 class="personalized-title">MADE for YOU</h2>
            <div class="personalized-grid">
                <div class="personalized-item">
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMikiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIxMiIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJjZW50cmFsIj5Qcm9kdWN0IDE8L3RleHQ+PC9zdmc+" alt="Product 1" style="width: 80px; height: 80px; margin-bottom: 10px;">
                    <h4>Impact Whey Protein</h4>
                    <p>₹1,999</p>
                    <button class="card-btn" style="background: rgba(255,255,255,0.2); border: 1px solid white;">Quick Buy</button>
                </div>
                
                <div class="personalized-item">
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMikiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIxMiIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJjZW50cmFsIj5Qcm9kdWN0IDI8L3RleHQ+PC9zdmc+" alt="Product 2" style="width: 80px; height: 80px; margin-bottom: 10px;">
                    <h4>Clear Whey Isolate</h4>
                    <p>₹2,499</p>
                    <button class="card-btn" style="background: rgba(255,255,255,0.2); border: 1px solid white;">Quick Buy</button>
                </div>
                
                <div class="personalized-item">
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMikiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIxMiIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJjZW50cmFsIj5Qcm9kdWN0IDM8L3RleHQ+PC9zdmc+" alt="Product 3" style="width: 80px; height: 80px; margin-bottom: 10px;">
                    <h4>Vegan Protein Blend</h4>
                    <p>₹2,199</p>
                    <button class="card-btn" style="background: rgba(255,255,255,0.2); border: 1px solid white;">Quick Buy</button>
                </div>
                
                <div class="personalized-item">
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMikiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIxMiIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJjZW50cmFsIj5Qcm9kdWN0IDQ8L3RleHQ+PC9zdmc+" alt="Product 4" style="width: 80px; height: 80px; margin-bottom: 10px;">
                    <h4>Total War Pre-Workout</h4>
                    <p>₹2,999</p>
                    <button class="card-btn" style="background: rgba(255,255,255,0.2); border: 1px solid white;">Quick Buy</button>
                </div>
            </div>
        </div>

        <!-- Reviews Section -->
        <div class="reviews-section">
            <h2 class="section-title" style="color: var(--primary-teal);">Customer Reviews</h2>
            
            <div class="review-summary">
                <div class="review-score">4.5</div>
                <div class="rating-stars mb-2">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star-half-alt"></i>
                </div>
                <p>Based on 4,267 reviews</p>
            </div>
            
            <div class="review-item">
                <div class="reviewer-name">Rajesh K.</div>
                <div class="review-date">Verified Purchase • 2 weeks ago</div>
                <div class="rating-stars mb-2">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                </div>
                <div class="review-text">
                    "Excellent quality creatine! I've been using this for 2 months now and have noticed significant improvements in my strength and endurance. Mixes well with water and has no taste. Highly recommended for anyone serious about their fitness goals."
                </div>
            </div>
            
            <div class="review-item">
                <div class="reviewer-name">Priya S.</div>
                <div class="review-date">Verified Purchase • 1 month ago</div>
                <div class="rating-stars mb-2">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                </div>
                <div class="review-text">
                    "Great value for money! The unflavoured version is perfect as it doesn't interfere with my protein shake taste. Fast delivery and excellent packaging. Will definitely order again."
                </div>
            </div>
            
            <div class="review-item">
                <div class="reviewer-name">Arjun M.</div>
                <div class="review-date">Verified Purchase • 3 weeks ago</div>
                <div class="rating-stars mb-2">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="far fa-star"></i>
                </div>
                <div class="review-text">
                    "Good product overall. I've noticed improvements in my gym performance. Only minor complaint is that it takes a bit more stirring to dissolve completely, but that's not a big issue. Would recommend."
                </div>
            </div>
            
            <div class="text-center mt-4">
                <button class="view-all-btn">View All Reviews</button>
            </div>
        </div>

        <!-- Additional Information Tabs -->
        <div class="product-details">
            <div class="details-tabs">
                <button class="tab-btn active" data-tab="faq">FAQ</button>
                <button class="tab-btn" data-tab="delivery">Delivery Info</button>
                <button class="tab-btn" data-tab="returns">Returns</button>
                <button class="tab-btn" data-tab="about">About MyProtein</button>
            </div>
            
            <div class="tab-content" id="faq">
                <h3>Frequently Asked Questions</h3>
                
                <div class="faq-item mb-4">
                    <h5>When should I take creatine?</h5>
                    <p>For best results, take 5g of creatine monohydrate daily. You can take it pre-workout, post-workout, or anytime during the day. Consistency is more important than timing.</p>
                </div>
                
                <div class="faq-item mb-4">
                    <h5>Do I need to do a loading phase?</h5>
                    <p>A loading phase isn't necessary. You can start with 5g daily and see results within 2-4 weeks. If you want faster results, you can take 20g daily for the first week, then reduce to 5g daily.</p>
                </div>
                
                <div class="faq-item mb-4">
                    <h5>Is this product vegetarian/vegan?</h5>
                    <p>Yes, our Complete Creatine Monohydrate is suitable for both vegetarians and vegans. It's made from synthetically produced creatine monohydrate.</p>
                </div>
                
                <div class="faq-item mb-4">
                    <h5>Can I mix this with protein shakes?</h5>
                    <p>Absolutely! Creatine mixes well with protein shakes, pre-workouts, or any other beverages. The unflavoured version won't affect the taste of your other supplements.</p>
                </div>
                
                <div class="faq-item mb-4">
                    <h5>What's the difference between this and other creatine forms?</h5>
                    <p>Creatine monohydrate is the most researched and proven form of creatine. It's been shown to be safe and effective in hundreds of studies. Other forms may claim advantages, but monohydrate remains the gold standard.</p>
                </div>
            </div>

        </div>
        {% if request.session.show_login_modal %}
        <script>
        document.addEventListener("DOMContentLoaded", function() {
            let modal = new bootstrap.Modal(document.getElementById('loginModal'));
            modal.show();
        });
        </script>
        {% endif %}


    </div>


    {% endblock body %}
{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script>









document.addEventListener("DOMContentLoaded", function () {

    /* -------------------- Thumbnails -------------------- */
    const mainImage = document.getElementById("main-product-image");
    const thumbnails = document.querySelectorAll(".product-thumbnails .thumbnail");

    if (mainImage && thumbnails.length > 0) {
        thumbnails.forEach(thumbnail => {
            thumbnail.addEventListener("click", function () {
                mainImage.src = this.src;
                thumbnails.forEach(t => t.classList.remove("active"));
                this.classList.add("active");
            });
        });
    }

    /* -------------------- Image Modal -------------------- */
    const modal = document.getElementById("imageModal");
    const modalImg = document.getElementById("enlarged-image");
    const closeBtn = document.querySelector(".close");

    if (mainImage && modal && modalImg) {
        mainImage.onclick = function () {
            modal.style.display = "block";
            modalImg.src = this.src;
        };
    }
    if (closeBtn) {
        closeBtn.onclick = function () {
            modal.style.display = "none";
        };
    }


/* -------------------- Add to Basket AJAX (Improved) -------------------- */
const basketForms = document.querySelectorAll(".add-to-basket-form");

basketForms.forEach(form => {
    form.addEventListener("submit", async function (event) {
        event.preventDefault();
        const csrfToken = form.querySelector("[name=csrfmiddlewaretoken]").value;

        try {
            const response = await fetch(form.action, {
                method: "POST",
                body: new FormData(form),
                headers: { "X-CSRFToken": csrfToken },
            });

            let data;
            try {
                data = await response.json();
            } catch {
                const text = await response.text();
                console.error("Non-JSON response:", text);
                return;
            }

            if (response.ok && data.success) {
                document.getElementById("basket-product-name").textContent = `${data.product} - ${data.variant}`;
                document.getElementById("basket-quantity").textContent = data.quantity;
                document.getElementById("basket-subtotal").textContent = data.subtotal;
                document.getElementById("basket-count").textContent = data.basket_count;
                document.getElementById("basket-product-image").src = data.image || "";

                const modal = new bootstrap.Modal(document.getElementById("basketModal"));
                modal.show();
            } else {
                console.warn("Server Error:", data);
            }
        } catch (error) {
            console.error("Fetch Error:", error);
        }
    });
});
/* -------------------- Auth Modal Functions -------------------- */
function openAuthModal() {
    document.getElementById('authModal').classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeAuthModal() {
    document.getElementById('authModal').classList.remove('active');
    document.body.style.overflow = 'auto';
}

document.getElementById('authModal')?.addEventListener('click', function (e) {
    if (e.target === this) closeAuthModal();
});
</script>

<!-- <script>
document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".wishlist-btn").forEach(btn => {
        btn.addEventListener("click", async (e) => {
            e.preventDefault();

            const variantId = btn.getAttribute("data-variant-id");
            const csrftoken = document.querySelector("[name=csrfmiddlewaretoken]").value;

            const response = await fetch(`/wishlist/toggle/${variantId}/`, {
                method: "POST",
                headers: {
                    "X-CSRFToken": csrftoken,
                    "X-Requested-With": "XMLHttpRequest",
                },
            });

            const data = await response.json();

            if (data.status === "success") {
                const icon = btn.querySelector("i");
                if (data.action === "added") {
                    icon.classList.remove("far");
                    icon.classList.add("fas");
                    icon.style.color = "#dc3545";
                } else if (data.action === "removed") {
                    icon.classList.remove("fas");
                    icon.classList.add("far");
                    icon.style.color = "";
                }
            }
        });
    });
});
</script> -->
{% endblock extra_js %}




















